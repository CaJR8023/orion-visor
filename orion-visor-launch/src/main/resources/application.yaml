server:
  port: 9200

spring:
  application:
    name: devops-platform-service
  profiles:
    active: dev
  main:
    # å…è®¸å¾ªç¯ä¾èµ–
    allow-circular-references: true
  servlet:
    # æ–‡ä»¶ä¸Šä¼ ç›¸å…³é…ç½®é¡¹
    multipart:
      # å•ä¸ªæ–‡ä»¶å¤§å°
      max-file-size: 16MB
      # æ¶ˆæ¯ä½“å¤§å°
      max-request-size: 32MB
  mvc:
    pathmatch:
      matching-strategy: ANT_PATH_MATCHER
  datasource:
    druid:
      driver-class-name: com.mysql.cj.jdbc.Driver
      # åˆå§‹è¿æ¥æ•°
      initial-size: 5
      # æœ€å°è¿æ¥æ± æ•°é‡
      min-idle: 5
      # æœ€å¤§è¿æ¥æ± æ•°é‡
      max-active: 20
      # é…ç½®è·å–è¿æ¥ç­‰å¾…è¶…æ—¶çš„æ—¶é—´
      max-wait: 600000
      # æ£€æµ‹é—´éš”
      time-between-eviction-runs-millis: 60000
      # æœ€å°ç”Ÿå­˜çš„æ—¶é—´
      min-evictable-idle-time-millis: 300000
      # æœ€å¤§ç”Ÿå­˜çš„æ—¶é—´
      max-evictable-idle-time-millis: 900000
      validation-query: SELECT 1
      web-stat-filter:
        enabled: true
      stat-view-servlet:
        enabled: true
        url-pattern: /druid/*
        login-username:
        login-password:
      filter:
        stat:
          enabled: true
          log-slow-sql: true
          slow-sql-millis: 800
          merge-sql: true
        wall:
          config:
            multi-statement-allow: true
  redis:
    database: 2
    connect-timeout: 5000
    timeout: 3000
  cache:
    type: REDIS
    redis:
      time-to-live: 1h
  output:
    ansi:
      enabled: DETECT
  quartz:
    job-store-type: JDBC
    overwrite-existing-jobs: false
    jdbc:
      initialize-schema: NEVER
    properties:
      org:
        quartz:
          scheduler:
            # å®ä¾‹ ID
            instanceId: AUTO
            instanceName: quartzScheduler
          jobStore:
            # æŒä¹…åŒ–é…ç½®
            class: org.quartz.impl.jdbcjobstore.JobStoreTX
            driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            useProperties: false
            tablePrefix: QRTZ_
            misfireThreshold: 60000
            clusterCheckinInterval: 5000
            isClustered: true
          #è¿æ¥æ± 
          threadPool:
            class: org.quartz.simpl.SimpleThreadPool
            threadCount: 5
            threadPriority: 5
            threadsInheritContextClassLoaderOfInitializingThread: true
  boot:
    admin:
      context-path: /admin
      client:
        url: http://127.0.0.1:${server.port}/${spring.boot.admin.context-path}
        instance:
          service-host-type: IP

management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: '*'

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  mapper-locations: classpath*:mapper/*Mapper.xml
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-not-delete-value: 0
      logic-delete-value: 1

springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui
    tags-sorter: alpha
    operations-sorter: alpha
    show-extensions: true

knife4j:
  enable: true
  setting:
    language: ZH_CN

logging:
  file:
    path: ${LOG_FILE_PATH:/opt/developer/app/logs/devops-platform}
    name: ${logging.file.path}/app.log
  logback:
    rollingpolicy:
      clean-history-on-start: false
      file-name-pattern: ${logging.file.path}/rolling/rolling-%d{yyyy-MM-dd}.%i.gz
      max-history: 30
      max-file-size: 16MB
      total-size-cap: 0B
  pattern:
    console: '%clr(%d{${LOG_DATEFORMAT_PATTERN:yyyy-MM-dd HH:mm:ss.SSS}}){faint} %clr(${LOG_LEVEL_PATTERN:-%6p}) %boldBlue([%X{tid}]) %clr([%22.22t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n${LOG_EXCEPTION_CONVERSION_WORD:%wEx}'
    file: "%d{${LOG_DATEFORMAT_PATTERN:yyyy-MM-dd HH:mm:ss.SSS}} ${LOG_LEVEL_PATTERN:-%6p} [%X{tid}] [%t] %-40.40logger{39} : %m%n${LOG_EXCEPTION_CONVERSION_WORD:%wEx}"
  level:
    com.orion.visor.launch.controller.BootstrapController: INFO

# åº”ç”¨é…ç½®
app:
  # è®¤è¯é…ç½®
  authentication:
    # æ˜¯å¦å…è®¸å¤šç«¯ç™»å½•
    allow-multi-device: true
    # æ˜¯å¦å…è®¸å‡­è¯ç»­ç­¾
    allow-refresh: true
    # å‡­è¯ç»­ç­¾æœ€å¤§æ¬¡æ•°
    max-refresh-count: 3
    # ç™»å½•å¤±è´¥é”å®šæ¬¡æ•°
    login-failed-lock-count: 5
    # ç™»å½•å¤±è´¥é”å®šæ—¶é—´ (åˆ†)
    login-failed-lock-time: 30
  # tracker é…ç½®
  tracker:
    # åŠ è½½åç§»é‡ (è¡Œ)
    offset: 300
    # å»¶è¿Ÿæ—¶é—´ (ms)
    delay: 100
    # æ–‡ä»¶æœªæ‰¾åˆ°ç­‰å¾…æ¬¡æ•°
    wait-times: 100
  # sftp é…ç½®
  sftp:
    # ä¸Šä¼ æ–‡ä»¶æ—¶ æ–‡ä»¶å­˜åœ¨æ˜¯å¦å¤‡ä»½
    upload-present-backup: true
    # å¤‡ä»½æ–‡ä»¶åç§°
    backup-file-name: bk_${fileName}_${timestamp}
  # æ‰§è¡Œæ—¥å¿—
  exec-log:
    # æ˜¯å¦æ‹¼æ¥ ansi æ‰§è¡ŒçŠ¶æ€æ—¥å¿—
    append-ansi: true
    # è‡ªåŠ¨æ¸…ç†æ‰§è¡Œæ–‡ä»¶
    auto-clear: true
    # ä¿ç•™å‘¨æœŸ (å¤©)
    keep-period: 30

# orion framework config
orion:
  # ç‰ˆæœ¬
  version: @revision@
  # æ˜¯å¦ä¸ºæ¼”ç¤ºæ¨¡å¼
  demo: false
  api:
    # å…¬å…± api å‰ç¼€
    prefix: /devops/api
    # æ˜¯å¦å¼€å¯è·¨åŸŸ
    cors: true
  websocket:
    # å…¬å…± websocket å‰ç¼€
    prefix: /devops/keep-alive
    # 1MB
    binary-buffer-size: 1048576
    # 1MB
    text-buffer-size: 1048576
    # 30MIN
    session-idle-timeout: 1800000
  swagger:
    # swagger é…ç½®
    author: ğŸ™ˆ
    title: è¿ç»´å¹³å°æ¥å£æ–‡æ¡£
    description: ä¸€ç«™å¼è¿ç»´æœåŠ¡å¹³å°
    version: ${orion.version}
    license: Apache-2.0
    grouped-api:
      infra:
        group: "infra - åŸºå»ºæ¨¡å—"
        path: "infra"
      asset:
        group: "asset - èµ„äº§æ¨¡å—"
        path: "asset"
  logging:
    # å…¨å±€æ—¥å¿—æ‰“å°
    printer:
      mode: PRETTY
      expression: 'execution (* com.orion.visor..*.controller..*.*(..))'
      headers:
        - user-agent,accept
        - content-type
      # ä¸‹é¢å¼•ç”¨äº† éœ€è¦æ³¨æ„
      field:
        ignore:
          - password,beforePassword,newPassword,useNewPassword,publicKey,privateKey,token
          - metrics
        desensitize:
  storage:
    # æœ¬åœ°æ–‡ä»¶å­˜å‚¨
    local:
      primary: true
      enabled: true
      timestamp-prefix: false
      date-directory: false
      storage-path: ${STORAGE_PATH:/opt/devops/storage}
      base-path: /
    # æ—¥å¿—æ–‡ä»¶å­˜å‚¨
    logs:
      enabled: true
      timestamp-prefix: false
      date-directory: false
      storage-path: ${STORAGE_PATH:/opt/devops/storage}
      base-path: /logs
  security:
    password-encoder-length: 4
    # åŒ¿åæ¥å£
    permit-url:
      - ${orion.api.prefix}/server/bootstrap/health
  crypto:
    # aesåŠ å¯†å™¨
    aes:
      primary: true
      enabled: true
      working-mode: ECB
      padding-mode: PKCS5_PADDING
      # åŠ å¯†å¯†é’¥
      secret-key: RGxPB3xKU9WfpMkh
      use-generator-key: true
      generator-key-length: 128
  async:
    # çº¿ç¨‹æ± é…ç½®
    executor:
      core-pool-size: 2
      max-pool-size: 4
      queue-capacity: 30
      keep-alive-seconds: 180
  operator-log:
    error-message-length: 255
    user-agent-length: 128
    ignore:
      - ${orion.logging.printer.field.ignore[0]}
      - ${orion.logging.printer.field.ignore[1]}
    desensitize:
